import { getConsentCookie, setConsentCookie } from './cookie-functions';
import { nodeListForEach } from './helpers';
import { sendPageViewEvent, sendAnalyticsCustomEvent, updateAnalyticsStorageConsent } from './analytics';
function CookiesPage($module) {
    this.$module = $module;
}
CookiesPage.prototype.init = function () {
    this.$cookiePage = this.$module;
    if (!this.$cookiePage) {
        return;
    }
    this.$cookieForm = this.$cookiePage.querySelector('.js-cookies-page-form');
    this.$cookieFormFieldsets = this.$cookieForm.querySelectorAll('.js-cookies-page-form-fieldset');
    this.$successNotification = this.$cookiePage.querySelector('.js-cookies-page-success');
    this.$successLink = this.$cookiePage.querySelector('.js-cookies-page-success-link');
    nodeListForEach(this.$cookieFormFieldsets, function ($cookieFormFieldset) {
        this.showUserPreference($cookieFormFieldset, getConsentCookie());
        /*        $cookieFormFieldset.removeAttribute('hidden')*/
    }.bind(this));
    // Show submit button
    //this.$cookieForm.querySelector('.js-cookies-form-button').removeAttribute('hidden')
    this.$cookieForm.addEventListener('submit', this.savePreferences.bind(this));
};
CookiesPage.prototype.savePreferences = function (event) {
    // Stop default form submission behaviour
    event.preventDefault();
    var preferences = {};
    nodeListForEach(this.$cookieFormFieldsets, function ($cookieFormFieldset) {
        var cookieType = this.getCookieType($cookieFormFieldset);
        var selectedItem = $cookieFormFieldset.querySelector('input[name=' + cookieType + ']:checked').value;
        preferences[cookieType] = selectedItem === 'true';
    }.bind(this));
    updateAnalyticsStorageConsent(true);
    const analyticsAccepted = preferences['analytics'];
    sendAnalyticsCustomEvent(analyticsAccepted, 'cookies');
    if (analyticsAccepted) {
        sendPageViewEvent();
    }
    else {
        updateAnalyticsStorageConsent(false);
    }
    setConsentCookie(preferences);
    // handle the corner case, where the user has selected their preference on the cookie page, whilst the banner is still open as they haven't previously selected their preference
    //todo: call hideBanner
    var banner = document.querySelector('[data-module="govuk-cookie-banner"]');
    banner.setAttribute('hidden', 'true');
    this.showSuccessNotification();
};
CookiesPage.prototype.showUserPreference = function ($cookieFormFieldset, preferences) {
    var cookieType = this.getCookieType($cookieFormFieldset);
    var preference = false;
    if (cookieType && preferences && preferences[cookieType] !== undefined) {
        preference = preferences[cookieType];
    }
    var radioValue = preference ? 'true' : 'false';
    var radio = $cookieFormFieldset.querySelector('input[name=' + cookieType + '][value=' + radioValue + ']');
    radio.checked = true;
};
CookiesPage.prototype.showSuccessNotification = function () {
    this.$successNotification.removeAttribute('hidden');
    // if the user's come to the cookies page through the link in the cookie banner, show a link to take them back to the page they came from
    //todo: use full url?
    var referrer = document.referrer ? new URL(document.referrer).pathname : false;
    if (referrer && referrer !== document.location.pathname) {
        this.$successLink.href = referrer;
        this.$successLink.removeAttribute('hidden');
    }
    else {
        this.$successLink.setAttribute('hidden', 'true');
    }
    // Set tabindex to -1 to make the element focusable with JavaScript.
    // GOV.UK Frontend will remove the tabindex on blur as the component doesn't
    // need to be focusable after the user has read the text.
    if (!this.$successNotification.getAttribute('tabindex')) {
        this.$successNotification.setAttribute('tabindex', '-1');
    }
    this.$successNotification.focus();
    // scroll to the top of the page
    window.scrollTo(0, 0);
};
CookiesPage.prototype.getCookieType = function ($cookieFormFieldset) {
    return $cookieFormFieldset.id;
};
export default CookiesPage;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvY29va2llcy1wYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFBaUIsTUFBTSxvQkFBb0IsQ0FBQTtBQUN0RixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBQzNDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSx3QkFBd0IsRUFBRSw2QkFBNkIsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUV4RyxTQUFTLFdBQVcsQ0FBQyxPQUFPO0lBQ3hCLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO0FBQzFCLENBQUM7QUFFRCxXQUFXLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRztJQUN6QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7SUFFL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUU7UUFDbkIsT0FBTTtLQUNUO0lBRUQsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFBO0lBQzFFLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLGdDQUFnQyxDQUFDLENBQUE7SUFDL0YsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLDBCQUEwQixDQUFDLENBQUE7SUFDdEYsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQywrQkFBK0IsQ0FBQyxDQUFBO0lBRW5GLGVBQWUsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsVUFBVSxtQkFBbUI7UUFDcEUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLG1CQUFtQixFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQTtRQUN4RSx5REFBeUQ7SUFDckQsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJ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QyxZQUFZLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztRQUNsQyxJQUFJLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQTtLQUM5QztTQUFNO1FBQ0gsSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0tBQ3BEO0lBRUQsb0VBQW9FO0lBQ3BFLDRFQUE0RTtJQUM1RSx5REFBeUQ7SUFDekQsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEVBQUU7UUFDckQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUE7S0FDM0Q7SUFFRCxJQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxFQUFFLENBQUE7SUFFakMsZ0NBQWdDO0lBQ2hDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0FBQ3pCLENBQUMsQ0FBQTtBQUVELFdBQVcsQ0FBQyxTQUFTLENBQUMsYUFBYSxHQUFHLFVBQVUsbUJBQW1CO0lBQy9ELE9BQU8sbUJBQW1CLENBQUMsRUFBRSxDQUFBO0FBQ2pDLENBQUMsQ0FBQTtBQUVELGVBQWUsV0FBVyxDQUFBIiwiZmlsZSI6ImNvbXBvbmVudHMvY29va2llcy1wYWdlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0Q29uc2VudENvb2tpZSwgc2V0Q29uc2VudENvb2tpZSwgQ29uc2VudENvb2tpZSB9IGZyb20gJy4vY29va2llLWZ1bmN0aW9ucydcclxuaW1wb3J0IHsgbm9kZUxpc3RGb3JFYWNoIH0gZnJvbSAnLi9oZWxwZXJzJ1xyXG5pbXBvcnQgeyBzZW5kUGFnZVZpZXdFdmVudCwgc2VuZEFuYWx5dGljc0N1c3RvbUV2ZW50LCB1cGRhdGVBbmFseXRpY3NTdG9yYWdlQ29uc2VudCB9IGZyb20gJy4vYW5hbHl0aWNzJ1xyXG5cclxuZnVuY3Rpb24gQ29va2llc1BhZ2UoJG1vZHVsZSkge1xyXG4gICAgdGhpcy4kbW9kdWxlID0gJG1vZHVsZVxyXG59XHJcblxyXG5Db29raWVzUGFnZS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuJGNvb2tpZVBhZ2UgPSB0aGlzLiRtb2R1bGVcclxuXHJcbiAgICBpZiAoIXRoaXMuJGNvb2tpZVBhZ2UpIHtcclxuICAgICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLiRjb29raWVGb3JtID0gdGhpcy4kY29va2llUGFnZS5xdWVyeVNlbGVjdG9yKCcuanMtY29va2llcy1wYWdlLWZvcm0nKVxyXG4gICAgdGhpcy4kY29va2llRm9ybUZpZWxkc2V0cyA9IHRoaXMuJGNvb2tpZUZvcm0ucXVlcnlTZWxlY3RvckFsbCgnLmpzLWNvb2tpZXMtcGFnZS1mb3JtLWZpZWxkc2V0JylcclxuICAgIHRoaXMuJHN1Y2Nlc3NOb3RpZmljYXRpb24gPSB0aGlzLiRjb29raWVQYWdlLnF1ZXJ5U2VsZWN0b3IoJy5qcy1jb29raWVzLXBhZ2Utc3VjY2VzcycpXHJcbiAgICB0aGlzLiRzdWNjZXNzTGluayA9IHRoaXMuJGNvb2tpZVBhZ2UucXVlcnlTZWxlY3RvcignLmpzLWNvb2tpZXMtcGFnZS1zdWNjZXNzLWxpbmsnKVxyXG5cclxuICAgIG5vZGVMaXN0Rm9yRWFjaCh0aGlzLiRjb29raWVGb3JtRmllbGRzZXRzLCBmdW5jdGlvbiAoJGNvb2tpZUZvcm1GaWVsZHNldCkge1xyXG4gICAgICAgIHRoaXMuc2hvd1VzZXJQcmVmZXJlbmNlKCRjb29raWVGb3JtRmllbGRzZXQsIGdldENvbnNlbnRDb29raWUoKSlcclxuLyogICAgICAgICRjb29raWVGb3JtRmllbGRzZXQucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKSovXHJcbiAgICB9LmJpbmQodGhpcykpXHJcblxyXG4gICAgLy8gU2hvdyBzdWJtaXQgYnV0dG9uXHJcbiAgICAvL3RoaXMuJGNvb2tpZUZvcm0ucXVlcnlTZWxlY3RvcignLmpzLWNvb2tpZXMtZm9ybS1idXR0b24nKS5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpXHJcblxyXG4gICAgdGhpcy4kY29va2llRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCB0aGlzLnNhdmVQcmVmZXJlbmNlcy5iaW5kKHRoaXMpKVxyXG59XHJcblxyXG5Db29raWVzUGFnZS5wcm90b3R5cGUuc2F2ZVByZWZlcmVuY2VzID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAvLyBTdG9wIGRlZmF1bHQgZm9ybSBzdWJtaXNzaW9uIGJlaGF2aW91clxyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICB2YXIgcHJlZmVyZW5jZXM6IENvbnNlbnRDb29raWUgPSB7fVxyXG5cclxuICAgIG5vZGVMaXN0Rm9yRWFjaCh0aGlzLiRjb29raWVGb3JtRmllbGRzZXRzLFxyXG4gICAgICAgIGZ1bmN0aW9uKCRjb29raWVGb3JtRmllbGRzZXQpIHtcclxuICAgICAgICAgICAgdmFyIGNvb2tpZVR5cGUgPSB0aGlzLmdldENvb2tpZVR5cGUoJGNvb2tpZUZvcm1GaWVsZHNldClcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9ICRjb29raWVGb3JtRmllbGRzZXQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0nICsgY29va2llVHlwZSArICddOmNoZWNrZWQnKS52YWx1ZVxyXG5cclxuICAgICAgICAgICAgcHJlZmVyZW5jZXNbY29va2llVHlwZV0gPSBzZWxlY3RlZEl0ZW0gPT09ICd0cnVlJ1xyXG4gICAgICAgIH0uYmluZCh0aGlzKSk7XHJcblxyXG4gICAgdXBkYXRlQW5hbHl0aWNzU3RvcmFnZUNvbnNlbnQodHJ1ZSk7XHJcbiAgICBjb25zdCBhbmFseXRpY3NBY2NlcHRlZCA9IHByZWZlcmVuY2VzWydhbmFseXRpY3MnXTtcclxuICAgIHNlbmRBbmFseXRpY3NDdXN0b21FdmVudChhbmFseXRpY3NBY2NlcHRlZCwgJ2Nvb2tpZXMnKTtcclxuXHJcbiAgICBpZiAoYW5hbHl0aWNzQWNjZXB0ZWQpIHtcclxuICAgICAgICBzZW5kUGFnZVZpZXdFdmVudCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB1cGRhdGVBbmFseXRpY3NTdG9yYWdlQ29uc2VudChmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q29uc2VudENvb2tpZShwcmVmZXJlbmNlcyk7XHJcblxyXG4gICAgLy8gaGFuZGxlIHRoZSBjb3JuZXIgY2FzZSwgd2hlcmUgdGhlIHVzZXIgaGFzIHNlbGVjdGVkIHRoZWlyIHByZWZlcmVuY2Ugb24gdGhlIGNvb2tpZSBwYWdlLCB3aGlsc3QgdGhlIGJhbm5lciBpcyBzdGlsbCBvcGVuIGFzIHRoZXkgaGF2ZW4ndCBwcmV2aW91c2x5IHNlbGVjdGVkIHRoZWlyIHByZWZlcmVuY2VcclxuICAgIC8vdG9kbzogY2FsbCBoaWRlQmFubmVyXHJcbiAgICB2YXIgYmFubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtbW9kdWxlPVwiZ292dWstY29va2llLWJhbm5lclwiXScpO1xyXG4gICAgYmFubmVyLnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgJ3RydWUnKTtcclxuICAgIFxyXG4gICAgdGhpcy5zaG93U3VjY2Vzc05vdGlmaWNhdGlvbigpXHJcbn1cclxuXHJcbkNvb2tpZXNQYWdlLnByb3RvdHlwZS5zaG93VXNlclByZWZlcmVuY2UgPSBmdW5jdGlvbiAoJGNvb2tpZUZvcm1GaWVsZHNldCwgcHJlZmVyZW5jZXMpIHtcclxuICAgIHZhciBjb29raWVUeXBlID0gdGhpcy5nZXRDb29raWVUeXBlKCRjb29raWVGb3JtRmllbGRzZXQpXHJcbiAgICB2YXIgcHJlZmVyZW5jZSA9IGZhbHNlXHJcblxyXG4gICAgaWYgKGNvb2tpZVR5cGUgJiYgcHJlZmVyZW5jZXMgJiYgcHJlZmVyZW5jZXNbY29va2llVHlwZV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHByZWZlcmVuY2UgPSBwcmVmZXJlbmNlc1tjb29raWVUeXBlXVxyXG4gICAgfVxyXG5cclxuICAgIHZhciByYWRpb1ZhbHVlID0gcHJlZmVyZW5jZSA/ICd0cnVlJyA6ICdmYWxzZSdcclxuICAgIHZhciByYWRpbyA9ICRjb29raWVGb3JtRmllbGRzZXQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0nICsgY29va2llVHlwZSArICddW3ZhbHVlPScgKyByYWRpb1ZhbHVlICsgJ10nKVxyXG4gICAgcmFkaW8uY2hlY2tlZCA9IHRydWVcclxufVxyXG5cclxuQ29va2llc1BhZ2UucHJvdG90eXBlLnNob3dTdWNjZXNzTm90aWZpY2F0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy4kc3VjY2Vzc05vdGlmaWNhdGlvbi5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpXHJcblxyXG4gICAgLy8gaWYgdGhlIHVzZXIncyBjb21lIHRvIHRoZSBjb29raWVzIHBhZ2UgdGhyb3VnaCB0aGUgbGluayBpbiB0aGUgY29va2llIGJhbm5lciwgc2hvdyBhIGxpbmsgdG8gdGFrZSB0aGVtIGJhY2sgdG8gdGhlIHBhZ2UgdGhleSBjYW1lIGZyb21cclxuICAgIC8vdG9kbzogdXNlIGZ1bGwgdXJsP1xyXG4gICAgdmFyIHJlZmVycmVyID0gZG9jdW1lbnQucmVmZXJyZXIgPyBuZXcgVVJMKGRvY3VtZW50LnJlZmVycmVyKS5wYXRobmFtZSA6IGZhbHNlO1xyXG4gICAgaWYgKHJlZmVycmVyICYmIHJlZmVycmVyICE9PSBkb2N1bWVudC5sb2NhdGlvbi5wYXRobmFtZSkge1xyXG4gICAgICAgIHRoaXMuJHN1Y2Nlc3NMaW5rLmhyZWYgPSByZWZlcnJlcjtcclxuICAgICAgICB0aGlzLiRzdWNjZXNzTGluay5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuJHN1Y2Nlc3NMaW5rLnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgJ3RydWUnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgdGFiaW5kZXggdG8gLTEgdG8gbWFrZSB0aGUgZWxlbWVudCBmb2N1c2FibGUgd2l0aCBKYXZhU2NyaXB0LlxyXG4gICAgLy8gR09WLlVLIEZyb250ZW5kIHdpbGwgcmVtb3ZlIHRoZSB0YWJpbmRleCBvbiBibHVyIGFzIHRoZSBjb21wb25lbnQgZG9lc24ndFxyXG4gICAgLy8gbmVlZCB0byBiZSBmb2N1c2FibGUgYWZ0ZXIgdGhlIHVzZXIgaGFzIHJlYWQgdGhlIHRleHQuXHJcbiAgICBpZiAoIXRoaXMuJHN1Y2Nlc3NOb3RpZmljYXRpb24uZ2V0QXR0cmlidXRlKCd0YWJpbmRleCcpKSB7XHJcbiAgICAgICAgdGhpcy4kc3VjY2Vzc05vdGlmaWNhdGlvbi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJylcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLiRzdWNjZXNzTm90aWZpY2F0aW9uLmZvY3VzKClcclxuXHJcbiAgICAvLyBzY3JvbGwgdG8gdGhlIHRvcCBvZiB0aGUgcGFnZVxyXG4gICAgd2luZG93LnNjcm9sbFRvKDAsIDApXHJcbn1cclxuXHJcbkNvb2tpZXNQYWdlLnByb3RvdHlwZS5nZXRDb29raWVUeXBlID0gZnVuY3Rpb24gKCRjb29raWVGb3JtRmllbGRzZXQpIHtcclxuICAgIHJldHVybiAkY29va2llRm9ybUZpZWxkc2V0LmlkXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IENvb2tpZXNQYWdlIl19
