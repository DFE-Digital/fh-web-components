import { getConsentCookie, setConsentCookie } from './cookie-functions';
import { nodeListForEach } from './helpers';
import { sendPageViewEvent, sendAnalyticsCustomEvent, updateAnalyticsStorageConsent } from './analytics';
function CookiesPage($module) {
    this.$module = $module;
}
CookiesPage.prototype.init = function () {
    this.$cookiePage = this.$module;
    if (!this.$cookiePage) {
        return;
    }
    this.$cookieForm = this.$cookiePage.querySelector('.js-cookies-page-form');
    this.$cookieFormFieldsets = this.$cookieForm.querySelectorAll('.js-cookies-page-form-fieldset');
    this.$successNotification = this.$cookiePage.querySelector('.js-cookies-page-success');
    this.$successLink = this.$cookiePage.querySelector('.js-cookies-page-success-link');
    nodeListForEach(this.$cookieFormFieldsets, function ($cookieFormFieldset) {
        this.showUserPreference($cookieFormFieldset, getConsentCookie());
        /*        $cookieFormFieldset.removeAttribute('hidden')*/
    }.bind(this));
    // Show submit button
    //this.$cookieForm.querySelector('.js-cookies-form-button').removeAttribute('hidden')
    this.$cookieForm.addEventListener('submit', this.savePreferences.bind(this));
};
CookiesPage.prototype.savePreferences = function (event) {
    // Stop default form submission behaviour
    event.preventDefault();
    var preferences = {};
    nodeListForEach(this.$cookieFormFieldsets, function ($cookieFormFieldset) {
        var cookieType = this.getCookieType($cookieFormFieldset);
        var selectedItem = $cookieFormFieldset.querySelector('input[name=' + cookieType + ']:checked').value;
        preferences[cookieType] = selectedItem === 'true';
    }.bind(this));
    updateAnalyticsStorageConsent(true);
    const analyticsAccepted = preferences['analytics'];
    sendAnalyticsCustomEvent(analyticsAccepted, 'cookies');
    if (analyticsAccepted) {
        sendPageViewEvent();
    }
    else {
        updateAnalyticsStorageConsent(false);
    }
    setConsentCookie(preferences);
    // handle the corner case, where the user has selected their preference on the cookie page, whilst the banner is still open as they haven't previously selected their preference
    //todo: call hideBanner
    var banner = document.querySelector('[data-module="govuk-cookie-banner"]');
    banner.setAttribute('hidden', 'true');
    this.showSuccessNotification();
};
CookiesPage.prototype.showUserPreference = function ($cookieFormFieldset, preferences) {
    var cookieType = this.getCookieType($cookieFormFieldset);
    var preference = false;
    if (cookieType && preferences && preferences[cookieType] !== undefined) {
        preference = preferences[cookieType];
    }
    var radioValue = preference ? 'true' : 'false';
    var radio = $cookieFormFieldset.querySelector('input[name=' + cookieType + '][value=' + radioValue + ']');
    radio.checked = true;
};
CookiesPage.prototype.showSuccessNotification = function () {
    this.$successNotification.removeAttribute('hidden');
    // if the user's come to the cookies page through the link in the cookie banner, show a link to take them back to the page they came from
    //todo: use full url?
    var referrer = document.referrer ? new URL(document.referrer).pathname : false;
    if (referrer && referrer !== document.location.pathname) {
        this.$successLink.href = referrer;
        this.$successLink.removeAttribute('hidden');
    }
    else {
        this.$successLink.setAttribute('hidden', 'true');
    }
    // Set tabindex to -1 to make the element focusable with JavaScript.
    // GOV.UK Frontend will remove the tabindex on blur as the component doesn't
    // need to be focusable after the user has read the text.
    if (!this.$successNotification.getAttribute('tabindex')) {
        this.$successNotification.setAttribute('tabindex', '-1');
    }
    this.$successNotification.focus();
    // scroll to the top of the page
    window.scrollTo(0, 0);
};
CookiesPage.prototype.getCookieType = function ($cookieFormFieldset) {
    return $cookieFormFieldset.id;
};
export default CookiesPage;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvY29va2llcy1wYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFBaUIsTUFBTSxvQkFBb0IsQ0FBQTtBQUN0RixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBQzNDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSx3QkFBd0IsRUFBRSw2QkFBNkIsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUV4RyxTQUFTLFdBQVcsQ0FBQyxPQUFPO0lBQ3hCLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO0FBQzFCLENBQUM7QUFFRCxXQUFXLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRztJQUN6QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7SUFFL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwQixPQUFNO0lBQ1YsQ0FBQztJQUVELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUMsQ0FBQTtJQUMxRSxJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFBO0lBQy9GLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFBO0lBQ3RGLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsK0JBQStCLENBQUMsQ0FBQTtJQUVuRixlQUFlLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLFVBQVUsbUJBQW1CO1FBQ3BFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxtQkFBbUIsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUE7UUFDeEUseURBQXlEO0lBQ3JELENBQUMsQ0FBQyxJQUFJ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LENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3RELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztRQUNsQyxJQUFJLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUMvQyxDQUFDO1NBQU0sQ0FBQztRQUNKLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsb0VBQW9FO0lBQ3BFLDRFQUE0RTtJQUM1RSx5REFBeUQ7SUFDekQsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztRQUN0RCxJQUFJLENBQUMsb0JBQW9CLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0lBRUQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssRUFBRSxDQUFBO0lBRWpDLGdDQUFnQztJQUNoQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUN6QixDQUFDLENBQUE7QUFFRCxXQUFXLENBQUMsU0FBUyxDQUFDLGFBQWEsR0FBRyxVQUFVLG1CQUFtQjtJQUMvRCxPQUFPLG1CQUFtQixDQUFDLEVBQUUsQ0FBQTtBQUNqQyxDQUFDLENBQUE7QUFFRCxlQUFlLFdBQVcsQ0FBQSIsImZpbGUiOiJjb21wb25lbnRzL2Nvb2tpZXMtcGFnZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldENvbnNlbnRDb29raWUsIHNldENvbnNlbnRDb29raWUsIENvbnNlbnRDb29raWUgfSBmcm9tICcuL2Nvb2tpZS1mdW5jdGlvbnMnXHJcbmltcG9ydCB7IG5vZGVMaXN0Rm9yRWFjaCB9IGZyb20gJy4vaGVscGVycydcclxuaW1wb3J0IHsgc2VuZFBhZ2VWaWV3RXZlbnQsIHNlbmRBbmFseXRpY3NDdXN0b21FdmVudCwgdXBkYXRlQW5hbHl0aWNzU3RvcmFnZUNvbnNlbnQgfSBmcm9tICcuL2FuYWx5dGljcydcclxuXHJcbmZ1bmN0aW9uIENvb2tpZXNQYWdlKCRtb2R1bGUpIHtcclxuICAgIHRoaXMuJG1vZHVsZSA9ICRtb2R1bGVcclxufVxyXG5cclxuQ29va2llc1BhZ2UucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLiRjb29raWVQYWdlID0gdGhpcy4kbW9kdWxlXHJcblxyXG4gICAgaWYgKCF0aGlzLiRjb29raWVQYWdlKSB7XHJcbiAgICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy4kY29va2llRm9ybSA9IHRoaXMuJGNvb2tpZVBhZ2UucXVlcnlTZWxlY3RvcignLmpzLWNvb2tpZXMtcGFnZS1mb3JtJylcclxuICAgIHRoaXMuJGNvb2tpZUZvcm1GaWVsZHNldHMgPSB0aGlzLiRjb29raWVGb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJy5qcy1jb29raWVzLXBhZ2UtZm9ybS1maWVsZHNldCcpXHJcbiAgICB0aGlzLiRzdWNjZXNzTm90aWZpY2F0aW9uID0gdGhpcy4kY29va2llUGFnZS5xdWVyeVNlbGVjdG9yKCcuanMtY29va2llcy1wYWdlLXN1Y2Nlc3MnKVxyXG4gICAgdGhpcy4kc3VjY2Vzc0xpbmsgPSB0aGlzLiRjb29raWVQYWdlLnF1ZXJ5U2VsZWN0b3IoJy5qcy1jb29raWVzLXBhZ2Utc3VjY2Vzcy1saW5rJylcclxuXHJcbiAgICBub2RlTGlzdEZvckVhY2godGhpcy4kY29va2llRm9ybUZpZWxkc2V0cywgZnVuY3Rpb24gKCRjb29raWVGb3JtRmllbGRzZXQpIHtcclxuICAgICAgICB0aGlzLnNob3dVc2VyUHJlZmVyZW5jZSgkY29va2llRm9ybUZpZWxkc2V0LCBnZXRDb25zZW50Q29va2llKCkpXHJcbi8qICAgICAgICAkY29va2llRm9ybUZpZWxkc2V0LnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJykqL1xyXG4gICAgfS5iaW5kKHRoaXMpKVxyXG5cclxuICAgIC8vIFNob3cgc3VibWl0IGJ1dHRvblxyXG4gICAgLy90aGlzLiRjb29raWVGb3JtLnF1ZXJ5U2VsZWN0b3IoJy5qcy1jb29raWVzLWZvcm0tYnV0dG9uJykucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKVxyXG5cclxuICAgIHRoaXMuJGNvb2tpZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5zYXZlUHJlZmVyZW5jZXMuYmluZCh0aGlzKSlcclxufVxyXG5cclxuQ29va2llc1BhZ2UucHJvdG90eXBlLnNhdmVQcmVmZXJlbmNlcyA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgLy8gU3RvcCBkZWZhdWx0IGZvcm0gc3VibWlzc2lvbiBiZWhhdmlvdXJcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgdmFyIHByZWZlcmVuY2VzOiBDb25zZW50Q29va2llID0ge31cclxuXHJcbiAgICBub2RlTGlzdEZvckVhY2godGhpcy4kY29va2llRm9ybUZpZWxkc2V0cyxcclxuICAgICAgICBmdW5jdGlvbigkY29va2llRm9ybUZpZWxkc2V0KSB7XHJcbiAgICAgICAgICAgIHZhciBjb29raWVUeXBlID0gdGhpcy5nZXRDb29raWVUeXBlKCRjb29raWVGb3JtRmllbGRzZXQpXHJcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZEl0ZW0gPSAkY29va2llRm9ybUZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9JyArIGNvb2tpZVR5cGUgKyAnXTpjaGVja2VkJykudmFsdWVcclxuXHJcbiAgICAgICAgICAgIHByZWZlcmVuY2VzW2Nvb2tpZVR5cGVdID0gc2VsZWN0ZWRJdGVtID09PSAndHJ1ZSdcclxuICAgICAgICB9LmJpbmQodGhpcykpO1xyXG5cclxuICAgIHVwZGF0ZUFuYWx5dGljc1N0b3JhZ2VDb25zZW50KHRydWUpO1xyXG4gICAgY29uc3QgYW5hbHl0aWNzQWNjZXB0ZWQgPSBwcmVmZXJlbmNlc1snYW5hbHl0aWNzJ107XHJcbiAgICBzZW5kQW5hbHl0aWNzQ3VzdG9tRXZlbnQoYW5hbHl0aWNzQWNjZXB0ZWQsICdjb29raWVzJyk7XHJcblxyXG4gICAgaWYgKGFuYWx5dGljc0FjY2VwdGVkKSB7XHJcbiAgICAgICAgc2VuZFBhZ2VWaWV3RXZlbnQoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdXBkYXRlQW5hbHl0aWNzU3RvcmFnZUNvbnNlbnQoZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldENvbnNlbnRDb29raWUocHJlZmVyZW5jZXMpO1xyXG5cclxuICAgIC8vIGhhbmRsZSB0aGUgY29ybmVyIGNhc2UsIHdoZXJlIHRoZSB1c2VyIGhhcyBzZWxlY3RlZCB0aGVpciBwcmVmZXJlbmNlIG9uIHRoZSBjb29raWUgcGFnZSwgd2hpbHN0IHRoZSBiYW5uZXIgaXMgc3RpbGwgb3BlbiBhcyB0aGV5IGhhdmVuJ3QgcHJldmlvdXNseSBzZWxlY3RlZCB0aGVpciBwcmVmZXJlbmNlXHJcbiAgICAvL3RvZG86IGNhbGwgaGlkZUJhbm5lclxyXG4gICAgdmFyIGJhbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW1vZHVsZT1cImdvdnVrLWNvb2tpZS1iYW5uZXJcIl0nKTtcclxuICAgIGJhbm5lci5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICd0cnVlJyk7XHJcbiAgICBcclxuICAgIHRoaXMuc2hvd1N1Y2Nlc3NOb3RpZmljYXRpb24oKVxyXG59XHJcblxyXG5Db29raWVzUGFnZS5wcm90b3R5cGUuc2hvd1VzZXJQcmVmZXJlbmNlID0gZnVuY3Rpb24gKCRjb29raWVGb3JtRmllbGRzZXQsIHByZWZlcmVuY2VzKSB7XHJcbiAgICB2YXIgY29va2llVHlwZSA9IHRoaXMuZ2V0Q29va2llVHlwZSgkY29va2llRm9ybUZpZWxkc2V0KVxyXG4gICAgdmFyIHByZWZlcmVuY2UgPSBmYWxzZVxyXG5cclxuICAgIGlmIChjb29raWVUeXBlICYmIHByZWZlcmVuY2VzICYmIHByZWZlcmVuY2VzW2Nvb2tpZVR5cGVdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBwcmVmZXJlbmNlID0gcHJlZmVyZW5jZXNbY29va2llVHlwZV1cclxuICAgIH1cclxuXHJcbiAgICB2YXIgcmFkaW9WYWx1ZSA9IHByZWZlcmVuY2UgPyAndHJ1ZScgOiAnZmFsc2UnXHJcbiAgICB2YXIgcmFkaW8gPSAkY29va2llRm9ybUZpZWxkc2V0LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9JyArIGNvb2tpZVR5cGUgKyAnXVt2YWx1ZT0nICsgcmFkaW9WYWx1ZSArICddJylcclxuICAgIHJhZGlvLmNoZWNrZWQgPSB0cnVlXHJcbn1cclxuXHJcbkNvb2tpZXNQYWdlLnByb3RvdHlwZS5zaG93U3VjY2Vzc05vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuJHN1Y2Nlc3NOb3RpZmljYXRpb24ucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKVxyXG5cclxuICAgIC8vIGlmIHRoZSB1c2VyJ3MgY29tZSB0byB0aGUgY29va2llcyBwYWdlIHRocm91Z2ggdGhlIGxpbmsgaW4gdGhlIGNvb2tpZSBiYW5uZXIsIHNob3cgYSBsaW5rIHRvIHRha2UgdGhlbSBiYWNrIHRvIHRoZSBwYWdlIHRoZXkgY2FtZSBmcm9tXHJcbiAgICAvL3RvZG86IHVzZSBmdWxsIHVybD9cclxuICAgIHZhciByZWZlcnJlciA9IGRvY3VtZW50LnJlZmVycmVyID8gbmV3IFVSTChkb2N1bWVudC5yZWZlcnJlcikucGF0aG5hbWUgOiBmYWxzZTtcclxuICAgIGlmIChyZWZlcnJlciAmJiByZWZlcnJlciAhPT0gZG9jdW1lbnQubG9jYXRpb24ucGF0aG5hbWUpIHtcclxuICAgICAgICB0aGlzLiRzdWNjZXNzTGluay5ocmVmID0gcmVmZXJyZXI7XHJcbiAgICAgICAgdGhpcy4kc3VjY2Vzc0xpbmsucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLiRzdWNjZXNzTGluay5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICd0cnVlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IHRhYmluZGV4IHRvIC0xIHRvIG1ha2UgdGhlIGVsZW1lbnQgZm9jdXNhYmxlIHdpdGggSmF2YVNjcmlwdC5cclxuICAgIC8vIEdPVi5VSyBGcm9udGVuZCB3aWxsIHJlbW92ZSB0aGUgdGFiaW5kZXggb24gYmx1ciBhcyB0aGUgY29tcG9uZW50IGRvZXNuJ3RcclxuICAgIC8vIG5lZWQgdG8gYmUgZm9jdXNhYmxlIGFmdGVyIHRoZSB1c2VyIGhhcyByZWFkIHRoZSB0ZXh0LlxyXG4gICAgaWYgKCF0aGlzLiRzdWNjZXNzTm90aWZpY2F0aW9uLmdldEF0dHJpYnV0ZSgndGFiaW5kZXgnKSkge1xyXG4gICAgICAgIHRoaXMuJHN1Y2Nlc3NOb3RpZmljYXRpb24uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy4kc3VjY2Vzc05vdGlmaWNhdGlvbi5mb2N1cygpXHJcblxyXG4gICAgLy8gc2Nyb2xsIHRvIHRoZSB0b3Agb2YgdGhlIHBhZ2VcclxuICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKVxyXG59XHJcblxyXG5Db29raWVzUGFnZS5wcm90b3R5cGUuZ2V0Q29va2llVHlwZSA9IGZ1bmN0aW9uICgkY29va2llRm9ybUZpZWxkc2V0KSB7XHJcbiAgICByZXR1cm4gJGNvb2tpZUZvcm1GaWVsZHNldC5pZFxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBDb29raWVzUGFnZSJdfQ==
