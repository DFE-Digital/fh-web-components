import { getConsentCookie, setConsentCookie } from './cookie-functions';
import { nodeListForEach } from './helpers';
import { sendPageViewEvent, sendAnalyticsCustomEvent, updateAnalyticsStorageConsent } from './analytics';
function CookiesPage($module) {
    this.$module = $module;
}
CookiesPage.prototype.init = function () {
    this.$cookiePage = this.$module;
    if (!this.$cookiePage) {
        return;
    }
    this.$cookieForm = this.$cookiePage.querySelector('.js-cookies-page-form');
    this.$cookieFormFieldsets = this.$cookieForm.querySelectorAll('.js-cookies-page-form-fieldset');
    this.$successNotification = this.$cookiePage.querySelector('.js-cookies-page-success');
    this.$successLink = this.$cookiePage.querySelector('.js-cookies-page-success-link');
    nodeListForEach(this.$cookieFormFieldsets, function ($cookieFormFieldset) {
        this.showUserPreference($cookieFormFieldset, getConsentCookie());
        /*        $cookieFormFieldset.removeAttribute('hidden')*/
    }.bind(this));
    // Show submit button
    //this.$cookieForm.querySelector('.js-cookies-form-button').removeAttribute('hidden')
    this.$cookieForm.addEventListener('submit', this.savePreferences.bind(this));
};
CookiesPage.prototype.savePreferences = function (event) {
    // Stop default form submission behaviour
    event.preventDefault();
    var preferences = {};
    nodeListForEach(this.$cookieFormFieldsets, function ($cookieFormFieldset) {
        var cookieType = this.getCookieType($cookieFormFieldset);
        var selectedItem = $cookieFormFieldset.querySelector('input[name=' + cookieType + ']:checked').value;
        preferences[cookieType] = selectedItem === 'true';
    }.bind(this));
    updateAnalyticsStorageConsent(true);
    const analyticsAccepted = preferences['analytics'];
    sendAnalyticsCustomEvent(analyticsAccepted, 'cookies');
    if (analyticsAccepted) {
        sendPageViewEvent();
    }
    else {
        updateAnalyticsStorageConsent(false);
    }
    setConsentCookie(preferences);
    // handle the corner case, where the user has selected their preference on the cookie page, whilst the banner is still open as they haven't previously selected their preference
    //todo: call hideBanner
    var banner = document.querySelector('[data-module="govuk-cookie-banner"]');
    banner.setAttribute('hidden', 'true');
    this.showSuccessNotification();
};
CookiesPage.prototype.showUserPreference = function ($cookieFormFieldset, preferences) {
    var cookieType = this.getCookieType($cookieFormFieldset);
    var preference = false;
    if (cookieType && preferences && preferences[cookieType] !== undefined) {
        preference = preferences[cookieType];
    }
    var radioValue = preference ? 'true' : 'false';
    var radio = $cookieFormFieldset.querySelector('input[name=' + cookieType + '][value=' + radioValue + ']');
    radio.checked = true;
};
CookiesPage.prototype.showSuccessNotification = function () {
    this.$successNotification.removeAttribute('hidden');
    // if the user's come to the cookies page through the link in the cookie banner, show a link to take them back to the page they came from
    //todo: use full url?
    var referrer = document.referrer ? new URL(document.referrer).pathname : false;
    if (referrer && referrer !== document.location.pathname) {
        this.$successLink.href = referrer;
        this.$successLink.removeAttribute('hidden');
    }
    else {
        this.$successLink.setAttribute('hidden', 'true');
    }
    // Set tabindex to -1 to make the element focusable with JavaScript.
    // GOV.UK Frontend will remove the tabindex on blur as the component doesn't
    // need to be focusable after the user has read the text.
    if (!this.$successNotification.getAttribute('tabindex')) {
        this.$successNotification.setAttribute('tabindex', '-1');
    }
    this.$successNotification.focus();
    // scroll to the top of the page
    window.scrollTo(0, 0);
};
CookiesPage.prototype.getCookieType = function ($cookieFormFieldset) {
    return $cookieFormFieldset.id;
};
export default CookiesPage;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvY29va2llcy1wYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFBaUIsTUFBTSxvQkFBb0IsQ0FBQTtBQUN0RixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBQzNDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSx3QkFBd0IsRUFBRSw2QkFBNkIsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUV4RyxTQUFTLFdBQVcsQ0FBQyxPQUFPO0lBQ3hCLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO0FBQzFCLENBQUM7QUFFRCxXQUFXLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRztJQUN6QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7SUFFL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwQixPQUFNO0lBQ1YsQ0FBQztJQUVELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUMsQ0FBQTtJQUMxRSxJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFBO0lBQy9GLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFBO0lBQ3RGLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsK0JBQStCLENBQUMsQ0FBQTtJQUVuRixlQUFlLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLFVBQVUsbUJBQW1CO1FBQ3BFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxtQkFBbUIsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUE7UUFDeEUseURBQXlEO0lBQ3JELENBQUMsQ0FBQyxJQUFJ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LENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3RELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztRQUNsQyxJQUFJLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUMvQyxDQUFDO1NBQU0sQ0FBQztRQUNKLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsb0VBQW9FO0lBQ3BFLDRFQUE0RTtJQUM1RSx5REFBeUQ7SUFDekQsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztRQUN0RCxJQUFJLENBQUMsb0JBQW9CLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0lBRUQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssRUFBRSxDQUFBO0lBRWpDLGdDQUFnQztJQUNoQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUN6QixDQUFDLENBQUE7QUFFRCxXQUFXLENBQUMsU0FBUyxDQUFDLGFBQWEsR0FBRyxVQUFVLG1CQUFtQjtJQUMvRCxPQUFPLG1CQUFtQixDQUFDLEVBQUUsQ0FBQTtBQUNqQyxDQUFDLENBQUE7QUFFRCxlQUFlLFdBQVcsQ0FBQSIsImZpbGUiOiJjb21wb25lbnRzL2Nvb2tpZXMtcGFnZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldENvbnNlbnRDb29raWUsIHNldENvbnNlbnRDb29raWUsIENvbnNlbnRDb29raWUgfSBmcm9tICcuL2Nvb2tpZS1mdW5jdGlvbnMnXG5pbXBvcnQgeyBub2RlTGlzdEZvckVhY2ggfSBmcm9tICcuL2hlbHBlcnMnXG5pbXBvcnQgeyBzZW5kUGFnZVZpZXdFdmVudCwgc2VuZEFuYWx5dGljc0N1c3RvbUV2ZW50LCB1cGRhdGVBbmFseXRpY3NTdG9yYWdlQ29uc2VudCB9IGZyb20gJy4vYW5hbHl0aWNzJ1xuXG5mdW5jdGlvbiBDb29raWVzUGFnZSgkbW9kdWxlKSB7XG4gICAgdGhpcy4kbW9kdWxlID0gJG1vZHVsZVxufVxuXG5Db29raWVzUGFnZS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLiRjb29raWVQYWdlID0gdGhpcy4kbW9kdWxlXG5cbiAgICBpZiAoIXRoaXMuJGNvb2tpZVBhZ2UpIHtcbiAgICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdGhpcy4kY29va2llRm9ybSA9IHRoaXMuJGNvb2tpZVBhZ2UucXVlcnlTZWxlY3RvcignLmpzLWNvb2tpZXMtcGFnZS1mb3JtJylcbiAgICB0aGlzLiRjb29raWVGb3JtRmllbGRzZXRzID0gdGhpcy4kY29va2llRm9ybS5xdWVyeVNlbGVjdG9yQWxsKCcuanMtY29va2llcy1wYWdlLWZvcm0tZmllbGRzZXQnKVxuICAgIHRoaXMuJHN1Y2Nlc3NOb3RpZmljYXRpb24gPSB0aGlzLiRjb29raWVQYWdlLnF1ZXJ5U2VsZWN0b3IoJy5qcy1jb29raWVzLXBhZ2Utc3VjY2VzcycpXG4gICAgdGhpcy4kc3VjY2Vzc0xpbmsgPSB0aGlzLiRjb29raWVQYWdlLnF1ZXJ5U2VsZWN0b3IoJy5qcy1jb29raWVzLXBhZ2Utc3VjY2Vzcy1saW5rJylcblxuICAgIG5vZGVMaXN0Rm9yRWFjaCh0aGlzLiRjb29raWVGb3JtRmllbGRzZXRzLCBmdW5jdGlvbiAoJGNvb2tpZUZvcm1GaWVsZHNldCkge1xuICAgICAgICB0aGlzLnNob3dVc2VyUHJlZmVyZW5jZSgkY29va2llRm9ybUZpZWxkc2V0LCBnZXRDb25zZW50Q29va2llKCkpXG4vKiAgICAgICAgJGNvb2tpZUZvcm1GaWVsZHNldC5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpKi9cbiAgICB9LmJpbmQodGhpcykpXG5cbiAgICAvLyBTaG93IHN1Ym1pdCBidXR0b25cbiAgICAvL3RoaXMuJGNvb2tpZUZvcm0ucXVlcnlTZWxlY3RvcignLmpzLWNvb2tpZXMtZm9ybS1idXR0b24nKS5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpXG5cbiAgICB0aGlzLiRjb29raWVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHRoaXMuc2F2ZVByZWZlcmVuY2VzLmJpbmQodGhpcykpXG59XG5cbkNvb2tpZXNQYWdlLnByb3RvdHlwZS5zYXZlUHJlZmVyZW5jZXMgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAvLyBTdG9wIGRlZmF1bHQgZm9ybSBzdWJtaXNzaW9uIGJlaGF2aW91clxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICB2YXIgcHJlZmVyZW5jZXM6IENvbnNlbnRDb29raWUgPSB7fVxuXG4gICAgbm9kZUxpc3RGb3JFYWNoKHRoaXMuJGNvb2tpZUZvcm1GaWVsZHNldHMsXG4gICAgICAgIGZ1bmN0aW9uKCRjb29raWVGb3JtRmllbGRzZXQpIHtcbiAgICAgICAgICAgIHZhciBjb29raWVUeXBlID0gdGhpcy5nZXRDb29raWVUeXBlKCRjb29raWVGb3JtRmllbGRzZXQpXG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRJdGVtID0gJGNvb2tpZUZvcm1GaWVsZHNldC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPScgKyBjb29raWVUeXBlICsgJ106Y2hlY2tlZCcpLnZhbHVlXG5cbiAgICAgICAgICAgIHByZWZlcmVuY2VzW2Nvb2tpZVR5cGVdID0gc2VsZWN0ZWRJdGVtID09PSAndHJ1ZSdcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIHVwZGF0ZUFuYWx5dGljc1N0b3JhZ2VDb25zZW50KHRydWUpO1xuICAgIGNvbnN0IGFuYWx5dGljc0FjY2VwdGVkID0gcHJlZmVyZW5jZXNbJ2FuYWx5dGljcyddO1xuICAgIHNlbmRBbmFseXRpY3NDdXN0b21FdmVudChhbmFseXRpY3NBY2NlcHRlZCwgJ2Nvb2tpZXMnKTtcblxuICAgIGlmIChhbmFseXRpY3NBY2NlcHRlZCkge1xuICAgICAgICBzZW5kUGFnZVZpZXdFdmVudCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHVwZGF0ZUFuYWx5dGljc1N0b3JhZ2VDb25zZW50KGZhbHNlKTtcbiAgICB9XG5cbiAgICBzZXRDb25zZW50Q29va2llKHByZWZlcmVuY2VzKTtcblxuICAgIC8vIGhhbmRsZSB0aGUgY29ybmVyIGNhc2UsIHdoZXJlIHRoZSB1c2VyIGhhcyBzZWxlY3RlZCB0aGVpciBwcmVmZXJlbmNlIG9uIHRoZSBjb29raWUgcGFnZSwgd2hpbHN0IHRoZSBiYW5uZXIgaXMgc3RpbGwgb3BlbiBhcyB0aGV5IGhhdmVuJ3QgcHJldmlvdXNseSBzZWxlY3RlZCB0aGVpciBwcmVmZXJlbmNlXG4gICAgLy90b2RvOiBjYWxsIGhpZGVCYW5uZXJcbiAgICB2YXIgYmFubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtbW9kdWxlPVwiZ292dWstY29va2llLWJhbm5lclwiXScpO1xuICAgIGJhbm5lci5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICd0cnVlJyk7XG4gICAgXG4gICAgdGhpcy5zaG93U3VjY2Vzc05vdGlmaWNhdGlvbigpXG59XG5cbkNvb2tpZXNQYWdlLnByb3RvdHlwZS5zaG93VXNlclByZWZlcmVuY2UgPSBmdW5jdGlvbiAoJGNvb2tpZUZvcm1GaWVsZHNldCwgcHJlZmVyZW5jZXMpIHtcbiAgICB2YXIgY29va2llVHlwZSA9IHRoaXMuZ2V0Q29va2llVHlwZSgkY29va2llRm9ybUZpZWxkc2V0KVxuICAgIHZhciBwcmVmZXJlbmNlID0gZmFsc2VcblxuICAgIGlmIChjb29raWVUeXBlICYmIHByZWZlcmVuY2VzICYmIHByZWZlcmVuY2VzW2Nvb2tpZVR5cGVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJlZmVyZW5jZSA9IHByZWZlcmVuY2VzW2Nvb2tpZVR5cGVdXG4gICAgfVxuXG4gICAgdmFyIHJhZGlvVmFsdWUgPSBwcmVmZXJlbmNlID8gJ3RydWUnIDogJ2ZhbHNlJ1xuICAgIHZhciByYWRpbyA9ICRjb29raWVGb3JtRmllbGRzZXQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0nICsgY29va2llVHlwZSArICddW3ZhbHVlPScgKyByYWRpb1ZhbHVlICsgJ10nKVxuICAgIHJhZGlvLmNoZWNrZWQgPSB0cnVlXG59XG5cbkNvb2tpZXNQYWdlLnByb3RvdHlwZS5zaG93U3VjY2Vzc05vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLiRzdWNjZXNzTm90aWZpY2F0aW9uLnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJylcblxuICAgIC8vIGlmIHRoZSB1c2VyJ3MgY29tZSB0byB0aGUgY29va2llcyBwYWdlIHRocm91Z2ggdGhlIGxpbmsgaW4gdGhlIGNvb2tpZSBiYW5uZXIsIHNob3cgYSBsaW5rIHRvIHRha2UgdGhlbSBiYWNrIHRvIHRoZSBwYWdlIHRoZXkgY2FtZSBmcm9tXG4gICAgLy90b2RvOiB1c2UgZnVsbCB1cmw/XG4gICAgdmFyIHJlZmVycmVyID0gZG9jdW1lbnQucmVmZXJyZXIgPyBuZXcgVVJMKGRvY3VtZW50LnJlZmVycmVyKS5wYXRobmFtZSA6IGZhbHNlO1xuICAgIGlmIChyZWZlcnJlciAmJiByZWZlcnJlciAhPT0gZG9jdW1lbnQubG9jYXRpb24ucGF0aG5hbWUpIHtcbiAgICAgICAgdGhpcy4kc3VjY2Vzc0xpbmsuaHJlZiA9IHJlZmVycmVyO1xuICAgICAgICB0aGlzLiRzdWNjZXNzTGluay5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy4kc3VjY2Vzc0xpbmsuc2V0QXR0cmlidXRlKCdoaWRkZW4nLCAndHJ1ZScpO1xuICAgIH1cblxuICAgIC8vIFNldCB0YWJpbmRleCB0byAtMSB0byBtYWtlIHRoZSBlbGVtZW50IGZvY3VzYWJsZSB3aXRoIEphdmFTY3JpcHQuXG4gICAgLy8gR09WLlVLIEZyb250ZW5kIHdpbGwgcmVtb3ZlIHRoZSB0YWJpbmRleCBvbiBibHVyIGFzIHRoZSBjb21wb25lbnQgZG9lc24ndFxuICAgIC8vIG5lZWQgdG8gYmUgZm9jdXNhYmxlIGFmdGVyIHRoZSB1c2VyIGhhcyByZWFkIHRoZSB0ZXh0LlxuICAgIGlmICghdGhpcy4kc3VjY2Vzc05vdGlmaWNhdGlvbi5nZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JykpIHtcbiAgICAgICAgdGhpcy4kc3VjY2Vzc05vdGlmaWNhdGlvbi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJylcbiAgICB9XG5cbiAgICB0aGlzLiRzdWNjZXNzTm90aWZpY2F0aW9uLmZvY3VzKClcblxuICAgIC8vIHNjcm9sbCB0byB0aGUgdG9wIG9mIHRoZSBwYWdlXG4gICAgd2luZG93LnNjcm9sbFRvKDAsIDApXG59XG5cbkNvb2tpZXNQYWdlLnByb3RvdHlwZS5nZXRDb29raWVUeXBlID0gZnVuY3Rpb24gKCRjb29raWVGb3JtRmllbGRzZXQpIHtcbiAgICByZXR1cm4gJGNvb2tpZUZvcm1GaWVsZHNldC5pZFxufVxuXG5leHBvcnQgZGVmYXVsdCBDb29raWVzUGFnZSJdfQ==
